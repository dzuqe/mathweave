
<!DOCTYPE html>
<html>
  <head>
    <title>MathWeave - Feed</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/code.css">
    <link rel="stylesheet" href="css/commandline.css">
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="page">
      <a href="/">Home</a>
      <a href="/history.html">History</a>
      <a href="/feed.html" class="selected">Feed</a>
      (ðŸ§½<a style="cursor: pointer; text-decoration: underline"  onClick="clearSession(document.getElementById('update'))">clear session</a>)
      <br/>
      <div id="update"></div>
      <div id="message">
        <h1>Feed <i>(latest 50)</i></h1>
      </div>
      <div id="history"></div>
    </div>
    <script src="https://unpkg.com/arweave/bundles/web.bundle.js"></script>
    <script src="js/utils.js"></script>
    <script>
        const load = async () => {
          const arweave = Arweave.init({
            host: 'arweave.net',
            port: 443,
            protocol: 'https',
            timeout: 20000,
            logging: false
          });

          const txids = await arweave.arql({
            op: 'equals',
            expr1: 'arweaveapp',
            expr2: 'arweavemathrepl',
          });

          const max = (txids.length >= 50) ? 50 : txids.length;
          for (var i = 0; i < max; i++) {
            const txid = txids[i];

            arweave
              .transactions
              .getData(txid, {decode: true, string: true})
              .then((data) => {
                document
                  .getElementById('history')
                  .innerHTML += replUIFactory(
                    txid, 
                    data, 
                    encodeData(data),
                  );
              });
          }
        };

        load();
    </script>
  </body>
</html>
